(this["webpackJsonpreact-books"]=this["webpackJsonpreact-books"]||[]).push([[0],{158:function(e,t,n){},159:function(e,t,n){},220:function(e,t,n){"use strict";n.r(t);var c=n(5),i=n(0),o=n.n(i),r=n(27),s=n.n(r),a=n(67),u=n(45),l=(n(158),n(59)),d=n(29),j=(n(159),n(160),n(49));function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=Object(a.c)();return[Object(a.d)(e,a.b),Object(i.useMemo)((function(){return Object(j.bindActionCreators)(t,n)}),[t,n])]}function O(e){var t=Object(a.c)();return Object(i.useMemo)((function(){return Object(j.bindActionCreators)(e,t)}),[e,t])}var h=n(83);h.a.initializeApp({apiKey:"AIzaSyCNu0FVw7ps2Z32lb_tfEeCRRvlRB0E4rw",authDomain:"react-books-42aa1.firebaseapp.com",databaseURL:"https://react-books-42aa1.firebaseio.com",projectId:"react-books-42aa1",storageBucket:"react-books-42aa1.appspot.com",messagingSenderId:"1093912261475",appId:"1:1093912261475:web:3765a6ea729962e1491956"});var p=h.a.firestore(),f=h.a.auth(),m=new h.a.auth.GithubAuthProvider;var x=n(15),k={favorite:"likedBy",marked:"markedBy",read:"readBy"};function y(e,t){return p.collection("books").doc(e).update(t).then((function(){return p.collection("books").doc(e).get()})).then(B)}function g(e){return e.docs.map(B)}function v(e){return e.get().then(B)}function B(e){return Object(x.a)({id:e.id},e.data())}function I(){return p.collection("books").get().then((function(e){return e.docs.map((function(e){return Object(x.a)({id:e.id},e.data())}))})).then((function(e){return{type:"GET_BOOKS",payload:{books:e}}}))}function E(){return{type:"UNSET_BOOKS"}}function T(e){return function(e){return p.collection("books").where("topics","array-contains",e).get().then(g)}(e).then((function(e){return{type:"GET_BOOKS",payload:{books:e}}}))}var S={getBooks:I,unsetBooks:E,getBooksByTopic:T,getBooksByFilter:function(e,t){return function(e,t){return p.collection("books").where(k[e],"array-contains",t).get().then(g)}(e,t).then((function(e){return{type:"GET_BOOKS",payload:{books:e}}}))},getBook:function(e){return function(e){return p.collection("books").where("slug","==",e).get().then((function(e){return e.docs[0].data()}))}(e).then((function(e){return{type:"GET_BOOK",payload:{book:e}}}))},unsetBook:function(){return{type:"UNSET_BOOK"}},likeBook:function(e,t){var n=t.uid,c={likedBy:e.likedBy?e.likedBy.includes(n)?e.likedBy.filter((function(e){return e!==n})):e.likedBy.concat(n):[n]};return y(e.id,c).then((function(e){return{type:"LIKE_BOOK",payload:{book:e}}}))},markBook:function(e,t){var n=t.uid,c={markedBy:e.markedBy?e.markedBy.includes(n)?e.markedBy.filter((function(e){return e!==n})):e.markedBy.concat(n):[n]};return y(e.id,c).then((function(e){return{type:"MARK_BOOK",payload:{book:e}}}))},readBook:function(e,t){var n=t.uid,c={readBy:e.readBy?e.readBy.includes(n)?e.readBy.filter((function(e){return e!==n})):e.readBy.concat(n):[n]};return y(e.id,c).then((function(e){return{type:"READ_BOOK",payload:{book:e}}}))}};var _=n(226),L=_.a.Meta,C=function(e){var t=e.book;return Object(c.jsx)(u.b,{to:"/books/".concat(t.slug),children:Object(c.jsx)(_.a,{className:"bookItem",hoverable:!0,style:{width:240},to:"/books/".concat(t.slug),cover:Object(c.jsx)("img",{alt:"example",src:t.imageUrl}),children:Object(c.jsx)(L,{title:t.title,description:"www.instagram.com"})})})},w=n(223),K=n(84),N=n(57),G=function(){var e=b((function(e){return e}),{getBooks:I}),t=Object(l.a)(e,2),n=t[0],o=t[1];Object(i.useEffect)((function(){o.getBooks()}),[]);var r=n.books.list;return Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(w.a,{style:{minHeight:"100vh"},id:"components-layout-demo-side",children:Object(c.jsx)(K.a,{gutter:{xs:8,sm:16,md:24,lg:32},children:r&&r.map((function(e){return Object(c.jsx)(N.a,{className:"gutter-row",span:4,children:Object(c.jsx)(C,{book:e})},e.id)}))})})})},R=n(227),A=n(225),U=n(148),F=n(104),P=n(224),D=n(229),M=n(230),H=n(231),z=n(232),J=n(233),W=n(234),V=function(e){var t=e.match,n=b((function(e){return{user:e.user,book:e.books.single}}),S),o=Object(l.a)(n,2),r=o[0],s=r.book,a=r.user,u=o[1];Object(i.useEffect)((function(){return u.getBook(t.params.bookId),function(){return u.unsetBook()}}),[u,t.params.bookId]);var d=Object(i.useCallback)((function(){a&&u.likeBook(s,a)}),[u,a,s]),j=Object(i.useCallback)((function(){a&&u.markBook(s,a)}),[u,a,s]),O=Object(i.useCallback)((function(){a&&u.readBook(s,a)}),[u,a,s]);return s?Object(c.jsxs)("div",{className:"bookPage",children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("img",{src:s&&s.imageUrl,alt:s&&s.title}),Object(c.jsxs)("div",{children:[Object(c.jsx)(A.b,{size:"small",bordered:!0,children:Object(c.jsxs)(A.b.Item,{children:[Object(c.jsx)(A.b.Item.Meta,{avatar:Object(c.jsx)(D.a,{}),title:s.author,description:"A\u0432\u0442\u043e\u0440"}),"\u0410\u0432\u0442\u043e\u0440: ",s.author]})}),Object(c.jsxs)("div",{children:["\u0410\u0432\u0442\u043e\u0440: ",s.author]}),Object(c.jsxs)("div",{children:["\u0418\u0437\u0434\u0430\u0442\u0435\u043b\u044c: ",s.publisher]}),Object(c.jsxs)("div",{children:["\u0413\u043e\u0434: ",s.year]}),Object(c.jsxs)("div",{children:["\u0412\u0441\u0435\u0433\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446: ",s.pages]}),Object(c.jsxs)("div",{children:["\u041a\u0430\u0442\u0435\u0433\u0442\u0440\u0438\u0438: ",s.topics&&s.topics.map((function(e){return e}))]})]})]}),Object(c.jsxs)("div",{className:"bookInfo",children:[Object(c.jsxs)("div",{className:"bookHeader",children:[Object(c.jsx)("h1",{children:s&&s.title}),Object(c.jsxs)("div",{children:[Object(c.jsxs)(U.a,{title:"Like me",children:[Object(c.jsx)("span",{className:"likes",children:s.likedBy&&s.likedBy.length}),Object(c.jsx)(F.a,{disabled:!a,onClick:d,type:"primary",shape:"circle",icon:a&&s.likedBy.includes(a.uid)?Object(c.jsx)(M.a,{}):Object(c.jsx)(H.a,{})})]}),Object(c.jsx)(U.a,{title:"Add to my List",children:Object(c.jsx)(F.a,{disabled:!a,onClick:j,type:"primary",shape:"circle",icon:a&&s.markedBy.includes(a.uid)?Object(c.jsx)(z.a,{}):Object(c.jsx)(D.a,{})})}),Object(c.jsx)(U.a,{title:"\u0412 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435",children:Object(c.jsx)(P.a,{onClick:O,component:a&&s.readBy.includes(a.uid)?J.a:W.a})})]})]}),s.description]})]}):Object(c.jsx)(R.a,{active:!0})},Z=function(e){var t=e.match,n=b((function(e){return{topic:e.topics.find((function(e){return e.id===t.params.topicId})),books:e.books.list}}),{getBooksByTopic:T,unsetBooks:E}),o=Object(l.a)(n,2),r=o[0],s=o[1];Object(i.useEffect)((function(){s.unsetBooks(),s.getBooksByTopic(t.params.topicId)}),[t.params.topicId]);var a=r.books.slice().sort((function(e,t){return t.likedBy.length-e.likedBy.length}));return Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:r.topic&&r.topic.title}),a.map((function(e){return Object(c.jsx)(C,{book:e},e.id)}))]})};function q(e){return function(e){return p.collection("lists").where("userId","==",e).get().then((function(e){return e.docs.map((function(e){return Object(x.a)({id:e.id},e.data())}))}))}(e).then((function(e){return{type:"GET_LISTS",payload:{lists:e}}}))}var Q={getLists:q,getList:function(e){return function(e){return p.collection("lists").doc(e).get().then(B).then((function(e){return Promise.all(e.books.map(v)).then((function(t){return e.books=t,e}))}))}(e).then((function(e){return{type:"GET_LIST",payload:{list:e}}}))},createList:function(e){return function(e){return p.collection("lists").add(e).then((function(e){return e.get()})).then(B)}(e).then((function(e){return{type:"CREATE_LIST",payload:{list:e}}}))}},X=function(e){var t=e.match,n=b((function(e){return e.lists.single}),Q),o=Object(l.a)(n,2),r=o[0],s=o[1];return Object(i.useEffect)((function(){r||s.getList(t.params.listId)}),[s,t.params.listId]),r?Object(c.jsx)("div",{id:"list-page",className:"page",children:Object(c.jsxs)(w.a,{style:{minHeight:"100vh"},id:"components-layout-demo-side",children:[Object(c.jsx)("h1",{children:r.title}),Object(c.jsx)(K.a,{gutter:{xs:8,sm:16,md:24,lg:32},children:r.books.map((function(e){return Object(c.jsx)(N.a,{className:"gutter-row",span:4,children:Object(c.jsx)(C,{book:e})},e.id)}))})]})}):Object(c.jsx)(R.a,{active:!0})},Y={favorite:"\u041f\u043e\u043d\u0440\u0430\u0432\u0438\u0432\u0448\u0438\u0435\u0441\u044f",marked:"\u041e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435",read:"\u041f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435"};function $(e){var t=e.match.params.filter,n=Object(a.d)((function(e){return e.user})),o=Object(a.d)((function(e){return e.books.list})),r=O(S);return Object(i.useEffect)((function(){r.getBooksByFilter(t,n.uid)}),[r,t,n]),n?Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)(w.a,{style:{minHeight:"100vh"},id:"components-layout-demo-side",children:[Object(c.jsx)("h1",{children:Y[t]}),Object(c.jsx)(K.a,{gutter:{xs:8,sm:16,md:24,lg:32},children:o&&o.map((function(e){return Object(c.jsx)(N.a,{className:"gutter-row",span:4,children:Object(c.jsx)(C,{book:e})},e.id)}))})]})}):"LOADING..."}var ee=n(118),te=n(235),ne=n(236),ce=n(237),ie=n(238),oe=(w.a.Header,w.a.Content,w.a.Footer,w.a.Sider,ee.a.SubMenu),re=function(e){var t=e.topics,n=e.user,i=e.lists,o=n?t.filter((function(e){return e.markedBy.includes(n.id)})):null,r=o?t.filter((function(e){return!o.includes(e)})):t;return Object(c.jsxs)(ee.a,{theme:"dark",defaultSelectedKeys:["1"],mode:"inline",children:[Object(c.jsx)(ee.a.Item,{icon:Object(c.jsx)(te.a,{}),children:Object(c.jsx)(u.c,{to:"/",children:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"})},"1"),Object(c.jsx)(ee.a.Item,{icon:Object(c.jsx)(ne.a,{}),children:Object(c.jsx)(u.b,{to:"/new",children:"\u041d\u043e\u0432\u044b\u0435"})},"2"),Object(c.jsx)(ee.a.Divider,{}),i&&i.list.map((function(e){return Object(c.jsx)(ee.a.Item,{children:Object(c.jsx)(u.b,{to:"/lists/".concat(e.id),children:e.title})},e.id)})),Object(c.jsx)(ee.a.Divider,{}),o.map((function(e){return Object(c.jsx)(ee.a.Item,{icon:Object(c.jsx)(ce.a,{}),children:Object(c.jsx)(u.c,{to:"/topics/".concat(e.id),children:e.title})},e.id)})),r.map((function(e){return Object(c.jsx)(ee.a.Item,{icon:Object(c.jsx)(ce.a,{}),children:Object(c.jsx)(u.c,{to:"/topics/".concat(e.id),children:e.title})},e.id)})),Object(c.jsxs)(oe,{icon:Object(c.jsx)(ie.a,{}),title:"User",children:[Object(c.jsx)(ee.a.Item,{children:"Tom"},"3"),Object(c.jsx)(ee.a.Item,{children:"Bill"},"4"),Object(c.jsx)(ee.a.Item,{children:"Alex"},"5")]},"sub1")]})},se=n(239),ae=n(240),ue=function(e){e.user;return Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(ee.a,{theme:"dark",defaultSelectedKeys:["1"],mode:"inline",children:[{path:"/favorite",title:"\u041f\u043e\u043d\u0440\u0430\u0432\u0438\u0432\u0448\u0438\u0435\u0441\u044f",icon:Object(c.jsx)(D.a,{})},{path:"/marked",title:"\u041e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435",icon:Object(c.jsx)(se.a,{})},{path:"/read",title:"\u041f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435",icon:Object(c.jsx)(ae.a,{})}].map((function(e){return Object(c.jsx)(ee.a.Item,{icon:e.icon,children:Object(c.jsx)(u.c,{to:e.path,children:e.title})},e.url)}))})})},le=n(228),de=n(241),je=w.a.Header,be=w.a.Content,Oe=w.a.Footer,he=w.a.Sider,pe=(ee.a.SubMenu,{getTopics:function(){return p.collection("topics").get().then((function(e){return e.docs.map((function(e){return Object(x.a)({id:e.id},e.data())}))})).then((function(e){return{type:"GET_TOPICS",payload:{topics:e}}}))},getLists:q,login:function(e){return{type:"LOGIN_USER",payload:{user:e}}},logout:function(){return{type:"LOGOUT_USER"}},getUser:function(e){return function(e){return p.collection("users").doc(e).get().then(B)}(e).then((function(e){return{type:"GET_USER",payload:{user:e}}}))}});var fe=function(){var e=Object(i.useState)(!1),t=Object(l.a)(e,2),n=t[0],o=t[1],r=Object(a.d)((function(e){return e.topics})),s=Object(a.d)((function(e){return e.user})),u=Object(a.d)((function(e){return e.lists})),j=O(pe),b=Object(d.f)();Object(i.useEffect)((function(){s&&j.getLists(s.uid+""),j.getTopics()}),[j]);var h=Object(i.useCallback)((function(){f.signOut(),b.push("/")}),[b]),p=Object(d.g)("/topics/:topicId"),x=Object(a.d)((function(e){return e.books.single})),k=p&&r.find((function(e){return e.id===p.params.topicId})),y=k&&k.title||x&&x.title||"";return Object(c.jsx)("div",{className:"app",children:Object(c.jsxs)(w.a,{style:{minHeight:"100vh"},id:"components-layout-demo-side",children:[Object(c.jsxs)(he,{collapsible:!0,collapsed:n,onCollapse:function(e){console.log(e),o(e)},children:[Object(c.jsx)("div",{className:"logo",children:s?Object(c.jsxs)("div",{onClick:function(){return h},children:[" ",s.email," ",Object(c.jsx)(F.a,{children:Object(c.jsx)(de.a,{})})]}):Object(c.jsxs)("div",{onClick:function(){return f.signInWithPopup(m).then((function(e){return e.user}))},children:[" ",Object(c.jsx)(F.a,{children:"LOG IN"})]})}),s&&Object(c.jsx)(ue,{}),Object(c.jsx)(re,{topics:r,lists:u,user:s})]}),Object(c.jsxs)(w.a,{className:"site-layout",children:[Object(c.jsx)(je,{className:"site-layout-background",style:{padding:0}}),Object(c.jsxs)(be,{style:{margin:"0 16px"},children:[Object(c.jsxs)(le.a,{style:{margin:"16px 0"},children:[Object(c.jsx)(le.a.Item,{children:"React Books"}),Object(c.jsx)(le.a.Item,{children:y&&y})]}),Object(c.jsx)("div",{className:"site-layout-background",style:{padding:24,minHeight:360},children:Object(c.jsxs)(d.c,{children:[Object(c.jsx)(d.a,{exact:!0,path:"/",component:G}),Object(c.jsx)(d.a,{path:"/new",children:Object(c.jsx)("h2",{children:"New"})}),Object(c.jsx)(d.a,{exact:!0,path:"/topics/:topicId",component:Z}),Object(c.jsx)(d.a,{exact:!0,path:"/:filter",component:$}),Object(c.jsx)(d.a,{path:"/books/:bookId",component:V}),Object(c.jsx)(d.a,{path:"/lists/:listId",component:X})]})})]}),Object(c.jsx)(Oe,{style:{textAlign:"center"},children:"React books "})]})]})})},me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,242)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),i(e),o(e),r(e)}))},xe=Object(j.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN_USER":return t.payload.user;case"LOGOUT_USER":return null;case"GET_USER":return Object(x.a)(Object(x.a)({},e),t.payload.user);default:return e}},books:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_BOOKS":return Object(x.a)(Object(x.a)({},e),{},{list:t.payload.books});case"UNSET_BOOKS":return Object(x.a)(Object(x.a)({},e),{},{list:[]});case"GET_BOOK":return Object(x.a)(Object(x.a)({},e),{},{single:t.payload.book});case"UNSET_BOOK":return Object(x.a)(Object(x.a)({},e),{},{single:null});case"LIKE_BOOK":case"MARK_BOOK":case"READ_BOOK":return Object(x.a)(Object(x.a)({},e),{},{single:t.payload.book});case"CREATE_BOOK":default:return e}},topics:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_TOPICS":return t.payload.topics;case"GET_TOPIC":return t.payload.book;case"CREATE_TOPIC":default:return e}},lists:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_LISTS":return Object(x.a)(Object(x.a)({},e),{},{list:t.payload.lists});case"GET_LIST":return Object(x.a)(Object(x.a)({},e),{},{single:t.payload.list});case"CREATE_LIST":case"UPDATE_LIST":case"DELETE_LIST":default:return e}}}),ke=n(143),ye=n.n(ke),ge=n(144),ve=n(145),Be=Object(ve.composeWithDevTools)(Object(j.applyMiddleware)(ge.a,ye.a)),Ie=Object(j.createStore)(xe,{user:{uid:777,email:"dum@mail.ru"},books:{list:[],single:null},lists:{list:[],single:null},topics:[]},Be);s.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(a.a,{store:Ie,children:Object(c.jsx)(u.a,{basename:"/books",children:Object(c.jsx)(fe,{})})})}),document.getElementById("root")),me()}},[[220,1,2]]]);
//# sourceMappingURL=main.c4e4fc29.chunk.js.map